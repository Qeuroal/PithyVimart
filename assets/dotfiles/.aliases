#! vim:ft=bash:

# proxy
if [[ "$(uname)" = 'Linux' ]]; then
    alias la="ls -ah"
    alias setproxy='export HTTP_PROXY=http://127.0.0.1:${PROXY_PORT:-7890} HTTPS_PROXY=http://127.0.0.1:${PROXY_PORT:-7890} FTP_PROXY=http://127.0.0.1:${PROXY_PORT:-7890} ALL_PROXY=socks://127.0.0.1:${PROXY_PORT:-7890} NO_PROXY=localhost,127.0.0.0/8,::1 http_proxy=http://127.0.0.1:${PROXY_PORT:-7890} https_proxy=http://127.0.0.1:${PROXY_PORT:-7890} ftp_proxy=http://127.0.0.1:${PROXY_PORT:-7890} all_proxy=socks://127.0.0.1:${PROXY_PORT:-7890} no_proxy=localhost,127.0.0.0/8,::1'
    alias unsetproxy="unset HTTP_PROXY HTTPS_PROXY FTP_PROXY ALL_PROXY NO_PROXY http_proxy https_proxy ftp_proxy all_proxy no_proxy"
    alias sk="slock"
elif [[ "$(uname)" = 'Darwin' ]]; then
    alias openmd="open -a Typora"
    alias la="ls -ah"
    alias setproxy='export HTTP_PROXY=http://127.0.0.1:${PROXY_PORT:-7890} HTTPS_PROXY=http://127.0.0.1:${PROXY_PORT:-7890} FTP_PROXY=http://127.0.0.1:${PROXY_PORT:-7890} ALL_PROXY=socks://127.0.0.1:${PROXY_PORT:-7890} NO_PROXY=localhost,127.0.0.0/8,::1 http_proxy=http://127.0.0.1:${PROXY_PORT:-7890} https_proxy=http://127.0.0.1:${PROXY_PORT:-7890} ftp_proxy=http://127.0.0.1:${PROXY_PORT:-7890} all_proxy=socks://127.0.0.1:${PROXY_PORT:-7890} no_proxy=localhost,127.0.0.0/8,::1'
    alias unsetproxy="unset HTTP_PROXY HTTPS_PROXY FTP_PROXY ALL_PROXY NO_PROXY http_proxy https_proxy ftp_proxy all_proxy no_proxy"
else
    echo "not support $(uname)"
fi

alias gtags="ctags --fields=+iaS --extra=+q --c-kinds=+p -R ."

# nvim replace vim
if command -v nvim > /dev/null; then
    alias vim="nvim -V1"
    alias vi="vim"
    alias vimdiff="vim -d"
fi
alias vim.="vim ."

# curl
alias curla='curl -A "Google Chrome"'
alias curlao='curl -A "Google Chrome" -JLO'

# git
alias gitm='git commit -m'
alias gita='git commit --amend'
alias gitd='git diff'
alias gits='git status -s'
alias gitsv='git status'
alias gitc='git clone'
alias gitcr='git clone --recursive'
alias git_local_help="echo 'git config --local user.name \$GIT_USERNAME \ngit config --local user.email \$GIT_USERMAIL \ngit config --local credential.helper store \ngit config --local --unset credential.helper \ngit config --local credential.username \$GIT_USERNAME\\n\\ngit remote rm origin \ngit remote add origin \$GIT_REMOTE_URL \ngit push --set-upstream origin master'"
alias git_local_user="[ -n \"\$GIT_USERNAME\" -a -n \"\$GIT_USERMAIL\" ] && echo 'modify git info' && git config --local user.name \$GIT_USERNAME && git config --local user.email \$GIT_USERMAIL && git config --local credential.helper store && git config --local --unset credential.helper && git config --local credential.username \$GIT_USERNAME"

# tmux
alias tls='tmux ls'
alias ta='tmux attach'
alias tt='tmux attach -t'
alias td='tmux detach'
alias tn='tmux new -s'

# tar
alias tarx='tar -zxvf'
alias tarc='tar -zcvf'

# yazi
function y() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
        builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

# aider
alias aidc='aider --model deepseek --set-env all_proxy="" --commit'

# navigation
alias ..='cd ..'
alias ...='cd ../..'
alias .3='cd ../../..'
alias .4='cd ../../../..'
alias .5='cd ../../../../..'

# ssh
alias sshl='ssh -L ${LPORT:-8888}:localhost:${LPORT:-8888}'
alias sshr='ssh -R ${RPORT:-7890}:localhost:${RPORT:-7890}'
# LOCAL/REMOTE_PORT_LOCAL/REMOTE
alias sshld='ssh -L ${LPORTL:-9091}:localhost:${LPORTR:-9090}'
alias sshrd='ssh -R ${RPORTL:-7890}:localhost:${RPORTR:-7890}'

# Changing "ls" to "eza"
if command -v eza > /dev/null; then
    alias ls='eza --color=always --group-directories-first' # ls
    alias la='eza -a --color=always --group-directories-first'  # all files and dirs
    alias ll='eza -l --color=always --group-directories-first'  # long format
    alias lla='eza -al --color=always --group-directories-first'  # long format for all files and dir
    alias lt='eza -aT --color=always --group-directories-first' # tree listing
    alias l.='eza -al --color=always --group-directories-first ../' # ls on the PARENT directory
    alias l..='eza -al --color=always --group-directories-first ../../' # ls on directory 2 levels up
    alias l...='eza -al --color=always --group-directories-first ../../../' # ls on directory 3 levels up
fi

# pacman and yay
alias pacsyu='sudo pacman -Syu'                  # update only standard pkgs
alias pacsyyu='sudo pacman -Syyu'                # Refresh pkglist & update standard pkgs
alias parsua='paru -Sua --noconfirm'             # update only AUR pkgs (paru)
alias parsyu='paru -Syu --noconfirm'             # update standard pkgs and AUR pkgs (paru)
alias unlock='sudo rm /var/lib/pacman/db.lck'    # remove pacman lock
alias orphan='sudo pacman -Rns $(pacman -Qtdq)' # remove orphaned packages (DANGEROUS!)

# adding flags
alias df='df -h'               # human-readable sizes
alias free='free -m'           # show sizes in MB
# alias grep='grep --color=auto' # colorize output (good for log files)

# type ranger &> /dev/null
if command -v ranger > /dev/null; then
    alias ra='ranger --choosedir=$HOME/.rangerdir; LASTDIR=`cat $HOME/.rangerdir`; cd "$LASTDIR"'
fi

# type joshuto &> /dev/null
if command -v joshuto > /dev/null; then
    function joshuto_remain() {
        ID="$$"
        mkdir -p /tmp/$USER
        OUTPUT_FILE="/tmp/$USER/joshuto-cwd-$ID"
        env joshuto --output-file "$OUTPUT_FILE" $@
        exit_code=$?

        case "$exit_code" in
            # regular exit
            0)
                ;;
            # output contains current directory
            101)
                JOSHUTO_CWD=$(cat "$OUTPUT_FILE")
                cd "$JOSHUTO_CWD"
                ;;
            # output selected files
            102)
                ;;
            *)
                echo "Exit code: $exit_code"
                ;;
        esac
        rm -rf $OUTPUT_FILE
    }
    alias jr='joshuto_remain'
fi

