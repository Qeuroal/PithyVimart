#! vim:ft=bash:

# command -v
alias cmv='command -v'

# proxy
alias setproxy='export HTTP_PROXY=http://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} HTTPS_PROXY=http://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} FTP_PROXY=http://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} ALL_PROXY=socks://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} NO_PROXY=localhost,127.0.0.0/8,::1 http_proxy=http://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} https_proxy=http://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} ftp_proxy=http://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} all_proxy=socks://${PROXY_IP:-127.0.0.1}:${PROXY_PORT:-7890} no_proxy=localhost,127.0.0.0/8,::1'
alias unsetproxy="unset HTTP_PROXY HTTPS_PROXY FTP_PROXY ALL_PROXY NO_PROXY http_proxy https_proxy ftp_proxy all_proxy no_proxy"
alias proxyst='ps -ef | grep "[c]lash"'

# print
alias lessr='less -R'

# slock
alias sk="slock"

# typora
[[ "$(uname)" == 'Darwin' ]] && alias openmd="open -a Typora"

alias gtags="ctags --fields=+iaS --extra=+q --c-kinds=+p -R ."

# nvim
if command -v nvim &> /dev/null; then
    alias vi='nvim -V1'
    alias vidiff='nvim -V1 -d'
    alias vim='nvim -V1'
    alias vimdiff='nvim -V1 -d'
fi
alias vi.="vi ."
alias vim.="vim ."
alias rmshada='rm -i -v $HOME/.local/state/nvim/shada/main.shada'

# curl
alias curla='curl -A "Google Chrome"'
alias curlao='curl -A "Google Chrome" -JLO'

# git
# 添加文件
alias ga='git add'                     # 添加指定文件
alias gA='git add -A'                  # 添加所有变更（新增+修改+删除）
alias gaU='git add -u'                 # 添加已跟踪文件的变更（修改+删除）
alias gap='git add -p'                 # 交互式添加（分块选择）

# 状态查看
alias gs='git status -sb'              # 简短状态
alias gst='git status'                 # 完整状态
alias gd='git diff'                    # 工作区差异
alias gvd='git vd'                     # 工作区差异 via vim
alias gdc='git diff --cached'          # 暂存区差异
alias gds='git diff --stat'            # 差异统计
# 提交
alias gc='git commit -m'               # 提交（需要消息）
alias gca='git commit --amend'         # 修改最后提交
alias gcn='git commit --amend --no-edit'  # 快速修改提交（不编辑消息）
# 日志查看
alias gl='git log -n'                  # 查看 n 条日志
alias gll='git log -n 1'               # 查看最后 1 条
alias gllc='git log -n 1 | grep "commit " | awk '"'"'{print $2}'"'" # 获取最后提交 hash
alias glp='git log --oneline -n 10'    # 简洁格式最近 10 条
alias glg='git log --graph --oneline --all -n 20'  # 图形化日志
# 分支操作
alias gb='git branch'                  # 列出本地分支
alias gba='git branch -a'              # 列出所有分支（含远程）
alias gco='git checkout'               # 切换分支/文件
# 远程操作
alias gcl='git clone'                  # 克隆仓库
alias gclr='git clone --recursive'     # 递归克隆（含子模块）
alias gpl='git pull'                   # 拉取远程更新
alias gps='git push'                   # 推送到远程
alias gpsu='git push -u origin'        # 首次推送并设置上游
alias gpsf='git push --force-with-lease'  # 安全的强制推送
alias gf='git fetch'                   # 获取远程更新
alias gfa='git fetch --all'            # 获取所有远程更新
alias gr='git remote'                  # 远程仓库管理
alias grv='git remote -v'              # 查看远程仓库详情
alias gra='git remote add'             # 添加远程仓库
alias grr='git remote remove'          # 删除远程仓库
alias gru='git remote set-url'         # 修改远程仓库 URL
# 暂存操作
alias gsh='git stash'                  # 暂存当前变更
alias gshp='git stash pop'             # 恢复最近暂存
alias gshl='git stash list'            # 查看暂存列表
# 配置
alias gcf='git config --list --show-origin'  # 查看配置
# 设置局部级用户信息
alias git_conflocal_help="echo 'git config --local user.name \$GIT_USERNAME \ngit config --local user.email \$GIT_USERMAIL \ngit config --local credential.helper store \ngit config --local --unset credential.helper \ngit config --local credential.username \$GIT_USERNAME\\n\\ngit remote rm origin \ngit remote add origin \$GIT_REMOTE_URL \ngit push --set-upstream origin master'"
alias git_conflocal_user="[ -n \"\$GIT_USERNAME\" -a -n \"\$GIT_USERMAIL\" ] && echo 'modify git info' && git config --local user.name \$GIT_USERNAME && git config --local user.email \$GIT_USERMAIL && git config --local credential.helper store && git config --local --unset credential.helper && git config --local credential.username \$GIT_USERNAME"

# tmux
alias tls='tmux ls'
alias ta='tmux attach'
alias tt='tmux attach -t'
alias td='tmux detach'
alias tn='tmux new -s'
alias tns='tmux new -s src'
alias tnn='tmux new -s note'
alias tnt='tmux new -s tmp'

# tar
alias tarx='tar -zxvf'
alias tarc='tar -zcvf'

# yazi
function y() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
        builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

# aider
alias aidc='aider --model deepseek --set-env all_proxy="" --commit'

# navigation
alias ..='cd ..'
alias cd.='cd $(realpath .)'
alias ...='cd ../..'
alias .3='cd ../../..'
alias .4='cd ../../../..'
alias .5='cd ../../../../..'

# ssh
alias sshls='ssh -L ${LPORT:-8888}:localhost:${LPORT:-8888}'
alias sshrs='ssh -R ${RPORT:-7890}:localhost:${RPORT:-7890}'
# LOCAL/REMOTE_PORT_LOCAL/REMOTE
alias sshld='ssh -L ${LPORTL:-9091}:localhost:${LPORTR:-9090}'
alias sshrd='ssh -R ${RPORTL:-7890}:localhost:${RPORTR:-7890}'

# Changing "ls" to "eza"
alias la='ls -a'  # all files and dirs
alias lla='ls -al'  # long format for all files and dirs
if command -v eza &> /dev/null; then
    alias ls='eza --color=always --group-directories-first' # ls
    alias la='eza -a --color=always --group-directories-first'  # all files and dirs
    alias ll='eza -l --color=always --group-directories-first'  # long format
    alias l='eza -al --color=always --group-directories-first'  # long format for all files and dir
    alias lla='eza -al --color=always --group-directories-first'  # long format for all files and dir
    alias lt='eza -aT --color=always --group-directories-first' # tree listing
    alias l.='eza -al --color=always --group-directories-first ../' # ls on the PARENT directory
    alias l..='eza -al --color=always --group-directories-first ../../' # ls on directory 2 levels up
    alias l...='eza -al --color=always --group-directories-first ../../../' # ls on directory 3 levels up
fi

# pacman and yay
alias pmsyu='sudo pacman -Syu'                  # update only standard pkgs
alias pmsyyu='sudo pacman -Syyu'                # Refresh pkglist & update standard pkgs
alias prsua='paru -Sua --noconfirm'             # update only AUR pkgs (paru)
alias prsyu='paru -Syu --noconfirm'             # update standard pkgs and AUR pkgs (paru)
alias unlock='sudo rm /var/lib/pacman/db.lck'    # remove pacman lock
alias orphan='sudo pacman -Rns $(pacman -Qtdq)' # remove orphaned packages (DANGEROUS!)

# adding flags
alias df='df -h'               # human-readable sizes
alias free='free -m'           # show sizes in MB
# alias grep='grep --color=auto' # colorize output (good for log files)

# gpu
if command -v gpustat &> /dev/null; then
    alias gpust='gpustat --color -cui'
elif command -v nvitop &> /dev/null; then
    alias gpust='nvitop'
elif command -v nvidia-smi &> /dev/null; then
    command -v watch &> /dev/null && alias gpust="watch -n 1 nvidia-smi" || alias gpust="nvidia-smi -l 1"
fi

# ip
alias ipst='curl ipinfo.io'

# link
# WARNING: export LN_TARGET_DIR="~/.local/bin" 中 ~ 不会展开
# WARNING: 正确用法: export LN_TARGET_DIR=~/.local/bin 或 export LN_TARGET_DIR="$HOME/.local/bin"
alias abslink_curdir=' [[ -f /bin/ls ]] && \
    ([[ -d ${LN_TARGET_DIR:-$HOME/.local/bin/} ]] && ln -si $(realpath $(/bin/ls)) ${LN_TARGET_DIR:-$HOME/.local/bin/} && echo "link $(realpath $(/bin/ls)) TO ${LN_TARGET_DIR:-$HOME/.local/bin/}" || echo "${LN_TARGET_DIR:-$HOME/.local/bin/} does not exist") \
    || echo "/bin/ls does not exist"'
[[ $(uname) == "Linux" ]] && alias rellink_curdir=' [[ -f /bin/ls ]] && \
    ([[ -d ${LN_TARGET_DIR:-$HOME/.local/bin/} ]] && ln -sri $(/bin/ls) ${LN_TARGET_DIR:-$HOME/.local/bin/} && echo "link $(/bin/ls) TO ${LN_TARGET_DIR:-$HOME/.local/bin/}" || echo "${LN_TARGET_DIR:-$HOME/.local/bin/} does not exist") \
    || echo "/bin/ls does not exist"'

# conda
alias cda='conda activate'
alias cdd='conda deactivate'
alias cdl='conda env list'

# systemctl - 系统服务管理
if command -v systemctl &> /dev/null; then
    alias sc='sudo systemctl'              # systemctl 基础命令
    alias scs='sudo systemctl status'      # 查看服务状态
    alias scS='sudo systemctl start'       # 启动服务
    alias scT='sudo systemctl stop'        # 停止服务
    alias scr='sudo systemctl restart'     # 重启服务
    alias sce='sudo systemctl enable'      # 开机自启
    alias scE='sudo systemctl disable'     # 禁用自启
    alias scd='sudo systemctl daemon-reload'  # 重载配置
    alias scl='sudo systemctl list-units --type=service'  # 列出所有服务
    alias sclf='sudo systemctl list-unit-files --type=service'  # 列出所有服务文件
    alias scf='sudo systemctl --failed'    # 查看失败的服务
    # 用户级别服务（不需要 sudo）
    alias scu='systemctl --user'           # 用户级 systemctl
    alias scus='systemctl --user status'   # 用户服务状态
    alias scuS='systemctl --user start'    # 启动用户服务
    alias scut='systemctl --user stop'     # 停止用户服务
    alias scur='systemctl --user restart'  # 重启用户服务
fi

